<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Employee Attendance Portal ‚Äî ITC SHUTDOWN 2025</title>

  <!-- html2canvas for client-side capture -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5wZ3zXq4+ZbJgXn1xvB2p1mS2k3gQYwX3qz2m1y1q9/0+UoI8V2zKp1cw5wX1R3lD7k1O4wzI7Yt9G1mBg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    body{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100%;color:#333}
    .container{width:100%;max-width:480px;margin:0 auto;padding:18px}
    .header{background:#fff;border-radius:12px;padding:18px;margin-bottom:16px;text-align:center}
    h1{margin:0;color:#667eea;font-size:20px}
    .search-section,.report-section,.grievance-section{background:#fff;border-radius:12px;padding:16px;margin-bottom:12px}
    .search-group{margin-bottom:12px}
    label{display:block;margin-bottom:6px;color:#666;font-weight:600}
    input,textarea{width:100%;padding:10px;border:1px solid #eee;border-radius:8px;font-size:15px}
    .btn{width:100%;padding:12px;border-radius:8px;border:0;color:#fff;font-weight:700;margin-bottom:10px;cursor:pointer}
    .btn-primary{background:#667eea}
    .btn-info{background:#17a2b8}
    .btn-secondary{background:#764ba2}
    .back-btn{background:#6c757d;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;margin-bottom:12px}
    .attendance-item{background:#f8f9fa;border-left:4px solid #667eea;padding:10px;margin-bottom:8px;border-radius:8px}
    .summary-cards{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
    .summary-card{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:12px;border-radius:8px;text-align:center}
    .message{display:none;padding:10px;border-radius:8px;margin-bottom:10px}
    .message.success{background:#d4edda;color:#155724}
    .message.error{background:#f8d7da;color:#721c24}
    .download-hint{font-size:13px;color:#444;margin-top:8px}
    @media(max-width:480px){h1{font-size:18px}}
    /* overlay for progress */
    #downloadOverlay{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:9999}
    #downloadOverlay .box{background:#fff;padding:16px;border-radius:8px;max-width:90%;text-align:center}
    /* hide raw data-source completely */
    .data-source-info{display:none!important}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Employee Attendance Portal</h1>
      <!-- Company name required by user -->
      <div id="company-name" style="font-size:13px;color:#666;font-weight:700">ITC SHUTDOWN 2025</div>
    </div>

    <div class="search-section" id="searchSection">
      <h2 style="font-size:16px;margin:0 0 8px 0">Search Attendance</h2>

      <!-- data source hidden entirely (per request) -->
      <div class="data-source-info" id="dataSourceInfo">hidden</div>

      <div class="search-group">
        <label for="empcode">Enter Employee Code</label>
        <input id="empcode" type="text" placeholder="e.g., EMP001" autocomplete="off"/>
      </div>

      <button id="searchBtn" class="btn btn-primary">View My Attendance</button>
      <button id="fetchDataBtn" class="btn btn-info">Fetch Latest Attendance</button>
      <button id="grievanceBtn" class="btn btn-info">Report Missing / OT</button>

      <div id="inlineMessage" class="message" style="margin-top:8px;"></div>
    </div>

    <div class="report-section" id="reportSection" style="display:none">
      <button id="backBtn" class="back-btn">‚Üê Back to Search</button>

      <div id="reportHeader" style="text-align:center;margin-bottom:12px">
        <div id="report-company" style="font-weight:700;color:#667eea">ITC SHUTDOWN 2025</div>
        <div id="empInfo" style="color:#333;margin-top:6px"></div>
      </div>

      <div class="summary-cards">
        <div class="summary-card">
          <div style="font-size:12px;opacity:.9">Total Present Days</div>
          <div id="totalPresent" style="font-size:20px;font-weight:800">0</div>
        </div>
        <div class="summary-card">
          <div style="font-size:12px;opacity:.9">Total OT Hours</div>
          <div id="totalOT" style="font-size:20px;font-weight:800">0</div>
        </div>
      </div>

      <div>
        <h3 style="margin:0 0 8px 0;font-size:15px">Attendance Records</h3>
        <div id="attendanceList"></div>
      </div>

      <div style="margin-top:12px">
        <button id="downloadBtn" class="btn btn-secondary">Download Report (JPG)</button>
        <div class="download-hint" id="downloadHint">If auto-download is blocked, the report will open in a new tab - long-press to save on mobile.</div>
      </div>
    </div>

    <div class="grievance-section" id="grievanceSection" style="display:none">
      <button id="backBtn2" class="back-btn">‚Üê Back to Search</button>
      <h2 style="font-size:16px;margin:0 0 8px 0">Report Missing Attendance / OT</h2>
      <div id="grievanceMessage" class="message"></div>
      <form id="grievanceForm">
        <div style="margin-bottom:8px">
          <label for="griev-empcode">Employee Code *</label>
          <input id="griev-empcode" required/>
        </div>
        <div style="margin-bottom:8px">
          <label for="griev-empname">Employee Name *</label>
          <input id="griev-empname" required/>
        </div>
        <div style="margin-bottom:8px">
          <label for="griev-date">Date *</label>
          <input id="griev-date" type="date" required/>
        </div>
        <div style="margin-bottom:8px">
          <label for="griev-issue">Issue Type *</label>
          <input id="griev-issue" placeholder="Missing attendance / Wrong OT" required/>
        </div>
        <div style="margin-bottom:8px">
          <label for="griev-details">Details *</label>
          <textarea id="griev-details" rows="4" required></textarea>
        </div>
        <button id="submitGrievance" class="btn btn-primary" type="submit">Submit Grievance</button>
      </form>
    </div>
  </div>

  <!-- overlay while generating image -->
  <div id="downloadOverlay"><div class="box"><div id="downloadOverlayText">Generating report...</div></div></div>

  <script>
    // Keep the Apps Script web app URL hidden (do NOT render it in UI).
    // Replace this value with your deployed Apps Script URL (no UI exposure).
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzq56KQRgnSMQPiqqP_-1XZYolm52m5iEq9EKXfBWfYxNyXCL4DlGjahlAwIjYd0gBy/exec'; // <-- set your URL here

    let externalDataCache = [];
    // Reference to a window opened during the search user gesture (to avoid popup blocking)
    let gestureWindowRef = null;

    // ---------- helper UI ----------
    function showInlineMessage(type, text, timeout = 4000) {
      const el = document.getElementById('inlineMessage');
      el.className = 'message ' + (type || '');
      el.textContent = text;
      el.style.display = 'block';
      setTimeout(()=> el.style.display = 'none', timeout);
    }
    function showGrievanceMessage(type, text, timeout = 4000) {
      const el = document.getElementById('grievanceMessage');
      el.className = 'message ' + (type || '');
      el.textContent = text;
      el.style.display = 'block';
      setTimeout(()=> el.style.display = 'none', timeout);
    }

    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    }
    function isSafari() {
      const ua = navigator.userAgent;
      return /Safari/.test(ua) && !/Chrome|Chromium|Android/.test(ua);
    }

    // ---------- fetching from Web App ----------
    async function fetchAllFromWebApp() {
      if (!WEB_APP_URL || WEB_APP_URL.includes('AKfy...')) {
        showInlineMessage('error','WEB_APP_URL not configured. Edit the HTML to set WEB_APP_URL.');
        return;
      }
      const btn = document.getElementById('fetchDataBtn');
      const orig = btn.textContent; btn.disabled = true; btn.textContent = 'Fetching...';
      try {
        const res = await fetch(WEB_APP_URL + '?action=all');
        if (res.ok) {
          const payload = await res.json();
          externalDataCache = Array.isArray(payload.data) ? payload.data : (Array.isArray(payload) ? payload : []);
          showInlineMessage('success','Fetched ' + (externalDataCache.length||0) + ' records.');
          return;
        }
        throw new Error('non-ok');
      } catch (err) {
        // JSONP fallback
        try {
          await new Promise((resolve,reject) => {
            const cb = 'cb_all_' + Date.now();
            window[cb] = function(resp) {
              try {
                externalDataCache = Array.isArray(resp.data) ? resp.data : (Array.isArray(resp) ? resp : []);
                resolve();
              } catch (e) { reject(e); } finally { delete window[cb]; const s = document.getElementById(cb + '_script'); if (s) s.remove(); }
            };
            const s = document.createElement('script');
            s.id = cb + '_script';
            s.src = WEB_APP_URL + '?action=all&callback=' + cb;
            s.onerror = function(){ delete window[cb]; s.remove(); reject(new Error('JSONP failed')); };
            document.head.appendChild(s);
          });
          showInlineMessage('success','Fetched ' + (externalDataCache.length||0) + ' records (JSONP).');
        } catch (e2) {
          showInlineMessage('error','Failed to fetch data: ' + (e2.message||e2));
        }
      } finally {
        btn.disabled = false; btn.textContent = orig;
      }
    }

    // ---------- search handling ----------
    document.getElementById('fetchDataBtn').addEventListener('click', fetchAllFromWebApp);

    document.getElementById('searchBtn').addEventListener('click', async function onSearchClick(e) {
      // Open a blank window synchronously in the user gesture so it won't be blocked.
      // We'll fill it later with the generated image or fallback content.
      gestureWindowRef = window.open('', '_blank'); // may be null if popup blocked

      const empcode = (document.getElementById('empcode').value || '').trim().toUpperCase();
      if (!empcode) {
        if (gestureWindowRef) { gestureWindowRef.close(); gestureWindowRef = null; }
        showInlineMessage('error','Please enter employee code'); 
        return;
      }

      this.disabled = true; const origText = this.textContent; this.textContent = 'Searching...';

      // look in local cache first
      let results = (externalDataCache || []).filter(r => (r.empcode || '').toString().toUpperCase() === empcode);

      // if none in cache, fetch employee endpoint
      if ((!results || results.length === 0) && WEB_APP_URL && !WEB_APP_URL.includes('AKfy...')) {
        try {
          const res = await fetch(WEB_APP_URL + '?action=employee&empcode=' + encodeURIComponent(empcode));
          if (res.ok) {
            const payload = await res.json();
            results = payload.data || (Array.isArray(payload) ? payload : []);
          } else {
            // JSONP fallback
            await new Promise((resolve,reject) => {
              const cb = 'cb_emp_' + Date.now();
              window[cb] = function(resp) {
                try {
                  results = Array.isArray(resp.data) ? resp.data : (Array.isArray(resp) ? resp : []);
                  resolve();
                } catch (e) { reject(e); } finally { delete window[cb]; const s = document.getElementById(cb + '_script'); if (s) s.remove(); }
              };
              const s = document.createElement('script');
              s.id = cb + '_script';
              s.src = WEB_APP_URL + '?action=employee&empcode=' + encodeURIComponent(empcode) + '&callback=' + cb;
              s.onerror = function(){ delete window[cb]; s.remove(); reject(new Error('JSONP failed')); };
              document.head.appendChild(s);
            });
          }
        } catch (err) {
          console.warn('employee fetch error', err);
        }
      }

      this.disabled = false; this.textContent = origText;

      if (!results || results.length === 0) {
        if (gestureWindowRef) { // close the opened window if nothing to show
          gestureWindowRef.document.write('<p style="font-family:sans-serif;padding:20px">No records found.</p>');
          setTimeout(()=> { try { gestureWindowRef.close(); } catch(e){}; gestureWindowRef = null; }, 1000);
        }
        showInlineMessage('error','No attendance records found for this employee code');
        return;
      }

      // Display report and then render to image into the previously opened gestureWindowRef (if available).
      displayReport(results, gestureWindowRef);
      // gestureWindowRef will be consumed/closed in the image generation routine
    });

    function displayReport(records, winRef) {
      document.getElementById('searchSection').style.display = 'none';
      document.getElementById('reportSection').style.display = 'block';

      const empcode = records[0].empcode || records[0].EMPCODE || '';
      const empname = records[0].empname || records[0].EMPNAME || '';
      document.getElementById('empInfo').innerHTML = '<strong>' + (empname||'') + '</strong> (' + (empcode||'') + ')';

      let totalPresent = records.length;
      let totalOT = 0;
      const listHtml = records.map(r => {
        const inT = (r.in_time || r.IN || r['IN'] || '');
        const outT = (r.out_time || r.OUT || r['OUT'] || '');
        const ot = calculateOT(inT,outT);
        totalOT += ot;
        const d = `${r.shdate||r.SHDATE||''}/${r.shmonth||r.SHM||r.SHMONT||''}/${r.shyear||r.SHYEAR||''}`;
        return `<div class="attendance-item"><div style="font-weight:700">${d}</div><div style="margin-top:6px;display:flex;justify-content:space-between"><div>üïê IN: ${inT}</div><div>üïê OUT: ${outT}</div></div>${ot>0?'<div style="margin-top:6px;color:#667eea;font-weight:700">‚è±Ô∏è OT: '+ot.toFixed(1)+' hours</div>':''}</div>`;
      }).join('');
      document.getElementById('attendanceList').innerHTML = listHtml;
      document.getElementById('totalPresent').textContent = totalPresent;
      document.getElementById('totalOT').textContent = totalOT.toFixed(1);

      // Build filename
      const safeName = ((empcode||'attendance') + '_' + (empname||'report')).replace(/\s+/g,'_').replace(/[^\w\-_.]/g,'');
      const filename = `${safeName}_${new Date().toISOString().slice(0,10)}.jpg`;

      // Generate image and populate the previously opened window (winRef) to avoid popup blockers.
      generateImageAndDeliver(document.getElementById('reportSection'), filename, winRef);
    }

    function calculateOT(inTime, outTime) {
      if (!inTime || !outTime) return 0;
      const [ih,im] = (inTime.split(':').map(Number));
      const [oh,om] = (outTime.split(':').map(Number));
      if (isNaN(ih) || isNaN(oh)) return 0;
      let inMin = ih*60 + (im||0);
      let outMin = oh*60 + (om||0);
      if (outMin < inMin) outMin += 24*60;
      const hours = (outMin-inMin)/60;
      return Math.max(0, hours - 12);
    }

    // ---------- robust image generation + delivery ----------
    // Strategy:
    // 1) If a window reference (opened during the user gesture) is available, write the image into that window and trigger a click on an anchor with download attribute.
    //    - This avoids popup blockers because the window was opened synchronously by the user's click.
    // 2) If no window ref (popup blocked), attempt blob+anchor in current window (works on Android/Chrome).
    // 3) For iOS/Safari, open the image in a new tab and let user long-press to save (download attribute ignored on Safari iOS).
    async function generateImageAndDeliver(element, filename, winRef) {
      const overlay = document.getElementById('downloadOverlay');
      const overlayText = document.getElementById('downloadOverlayText');
      overlayText.textContent = 'Preparing report image...';
      overlay.style.display = 'flex';

      try {
        const scale = Math.min(window.devicePixelRatio || 2, 3);
        const canvas = await html2canvas(element, { scale: scale, useCORS: true, allowTaint: true, logging:false });

        // Preferred: use the window opened during gesture (winRef) to deliver the image and click the download link inside it.
        if (winRef && !winRef.closed) {
          try {
            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.92));
            const url = URL.createObjectURL(blob);
            // Write a small HTML page into the window that immediately triggers the download anchor click and shows the image as fallback.
            const html = `
              <!doctype html>
              <html>
              <head><meta name="viewport" content="width=device-width,initial-scale=1"/></head>
              <body style="margin:0;font-family:Segoe UI,Roboto,Arial">
                <div style="padding:16px;text-align:center">
                  <p style="font-weight:700;margin:0 0 8px 0">Attendance Report</p>
                  <img src="${url}" style="max-width:100%;height:auto;display:block;margin:8px auto"/>
                  <p style="font-size:13px;color:#333;margin:8px 0 0 0">If download does not start automatically, long-press the image to save.</p>
                </div>
                <a id="dl" href="${url}" download="${filename}" style="display:none"></a>
                <script>
                  (function(){
                    try{ document.getElementById('dl').click(); }catch(e){}
                    // revoke object URL after some time
                    setTimeout(()=>{ try{ URL.revokeObjectURL('${url}'); }catch(e){} },3000);
                  })();
                </script>
              </body>
              </html>`;
            winRef.document.open();
            winRef.document.write(html);
            winRef.document.close();
            overlay.style.display = 'none';
            showInlineMessage('success','Report delivered. If it did not save automatically, use long-press on the image.');
            // clear the reference (we used it)
            gestureWindowRef = null;
            return true;
          } catch (winErr) {
            // if writing fails, continue to other strategies
            console.warn('winRef delivery failed', winErr);
          }
        }

        // If we get here, either winRef wasn't available or failed. Use other strategies.

        // iOS Safari: open in new tab with the image (download attribute ignored)
        if (isIOS() && isSafari()) {
          try {
            const dataUrl = canvas.toDataURL('image/jpeg', 0.92);
            const newWin = window.open();
            if (newWin) {
              newWin.document.write(`<title>Attendance Report</title><img src="${dataUrl}" style="max-width:100%;height:auto;display:block;margin:0 auto"/><p style="text-align:center;font-size:13px">Long-press the image to save.</p>`);
              newWin.document.close();
              overlay.style.display = 'none';
              showInlineMessage('success','Report opened in a new tab. Long-press the image to save.');
              return true;
            } else {
              overlay.style.display = 'none';
              showInlineMessage('error','Popup blocked. Please tap "Download Report (JPG)".');
              return false;
            }
          } catch (err) {
            console.warn('iOS fallback failed', err);
          }
        }

        // For other browsers: blob + anchor.download (preferred)
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.92));
        if (!blob) throw new Error('Failed to create image blob');

        if (window.navigator && window.navigator.msSaveOrOpenBlob) {
          // IE/Edge legacy
          window.navigator.msSaveOrOpenBlob(blob, filename);
          overlay.style.display = 'none';
          showInlineMessage('success','Download started.');
          return true;
        }

        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        // Append to DOM so click works in some browsers
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        // cleanup
        setTimeout(()=> { URL.revokeObjectURL(url); a.remove(); }, 1500);
        overlay.style.display = 'none';
        showInlineMessage('success','Download started. If not, tap Download Report (JPG).');
        return true;

      } catch (err) {
        overlay.style.display = 'none';
        // final fallback: open in new tab
        try {
          const canvas2 = await html2canvas(element, { scale: 1.5, useCORS: true, allowTaint: true });
          const dataUrl = canvas2.toDataURL('image/jpeg', 0.9);
          const w = window.open();
          if (w) {
            w.document.write(`<title>Attendance Report</title><img src="${dataUrl}" style="max-width:100%;height:auto;display:block;margin:0 auto"/><p style="text-align:center">Long-press the image to save.</p>`);
            w.document.close();
            showInlineMessage('success','Report opened in a new tab. Long-press to save.');
            return true;
          } else {
            showInlineMessage('error','Popup blocked. Please tap the Download button.');
            return false;
          }
        } catch (finalErr) {
          showInlineMessage('error','Failed to generate report image: ' + (finalErr.message || finalErr));
          return false;
        }
      } finally {
        // ensure gestureWindowRef cleaned up if still present (we may keep it so user can interact)
        try { if (gestureWindowRef && !gestureWindowRef.closed) { /* keep open for user */ } } catch(e){}
      }
    }

    // Manual download button uses the same routine but since click is a user gesture if popup blocked we can open a window now
    document.getElementById('downloadBtn').addEventListener('click', function() {
      // open a window in the click gesture to make delivery reliable
      const win = window.open('', '_blank');
      // build safe file name
      const empInfo = (document.getElementById('empInfo').textContent||'attendance').replace(/\s+/g,'_').replace(/[^\w\-_.]/g,'');
      const filename = `${empInfo}_${new Date().toISOString().slice(0,10)}.jpg`;
      generateImageAndDeliver(document.getElementById('reportSection'), filename, win);
    });

    // ---------- grievance handling ----------
    document.getElementById('grievanceForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const btn = document.getElementById('submitGrievance');
      const orig = btn.textContent; btn.disabled = true; btn.textContent = 'Submitting...';
      const data = {
        empcode: document.getElementById('griev-empcode').value.trim(),
        empname: document.getElementById('griev-empname').value.trim(),
        date: document.getElementById('griev-date').value,
        issue_type: document.getElementById('griev-issue').value.trim(),
        details: document.getElementById('griev-details').value.trim()
      };
      try {
        if (!WEB_APP_URL || WEB_APP_URL.includes('AKfy...')) {
          showGrievanceMessage('error','WEB_APP_URL not configured. Cannot submit grievance.');
          return;
        }
        try {
          const res = await fetch(WEB_APP_URL + '?action=submit_grievance&empcode=' + encodeURIComponent(data.empcode) + '&empname=' + encodeURIComponent(data.empname) + '&date=' + encodeURIComponent(data.date) + '&issue_type=' + encodeURIComponent(data.issue_type) + '&details=' + encodeURIComponent(data.details));
          if (res.ok) {
            const p = await res.json();
            if (p.isOk) {
              showGrievanceMessage('success','Grievance submitted.');
              this.reset();
            } else {
              showGrievanceMessage('error','Failed to submit grievance.');
            }
          } else {
            throw new Error('Non-OK');
          }
        } catch (err) {
          // JSONP fallback
          await new Promise((resolve,reject) => {
            const cb = 'cb_griev_' + Date.now();
            window[cb] = function(resp) {
              try {
                if (resp && resp.isOk) { showGrievanceMessage('success','Grievance submitted.'); document.getElementById('grievanceForm').reset(); resolve(); }
                else { showGrievanceMessage('error','Failed to submit grievance.'); reject(new Error('submit failed')); }
              } catch (e){ reject(e); } finally { delete window[cb]; const s = document.getElementById(cb + '_script'); if (s) s.remove(); }
            };
            const s = document.createElement('script');
            s.id = cb + '_script';
            s.src = WEB_APP_URL + '?action=submit_grievance&empcode=' + encodeURIComponent(data.empcode) + '&empname=' + encodeURIComponent(data.empname) + '&date=' + encodeURIComponent(data.date) + '&issue_type=' + encodeURIComponent(data.issue_type) + '&details=' + encodeURIComponent(data.details) + '&callback=' + cb;
            s.onerror = function(){ delete window[cb]; s.remove(); reject(new Error('JSONP failed')); };
            document.head.appendChild(s);
          });
        }
      } catch (e) {
        showGrievanceMessage('error','Failed to submit grievance: ' + (e.message||e));
      } finally {
        btn.disabled = false; btn.textContent = orig;
        setTimeout(()=> {
          document.getElementById('grievanceSection').style.display = 'none';
          document.getElementById('searchSection').style.display = 'block';
        }, 1200);
      }
    });

    // ---------- navigation ----------
    document.getElementById('backBtn').addEventListener('click', ()=> {
      document.getElementById('reportSection').style.display = 'none';
      document.getElementById('searchSection').style.display = 'block';
    });
    document.getElementById('grievanceBtn').addEventListener('click', ()=> {
      document.getElementById('searchSection').style.display = 'none';
      document.getElementById('grievanceSection').style.display = 'block';
    });
    document.getElementById('backBtn2').addEventListener('click', ()=> {
      document.getElementById('grievanceSection').style.display = 'none';
      document.getElementById('searchSection').style.display = 'block';
    });

    // Initialize: ensure data-source label is hidden and company name set
    (function init(){
      // hide data source element completely
      const ds = document.getElementById('dataSourceInfo'); if (ds) ds.style.display = 'none';
      document.getElementById('company-name').textContent = 'ITC SHUTDOWN 2025';
      document.getElementById('report-company').textContent = 'ITC SHUTDOWN 2025';
    })();
  </script>
</body>
</html>
